<!--<div class="page-header">
	123
</div>-->
<div class="afisha">
<!--	<a class="afisha-pager" href="#"><div class="arrow-up"></div></a>-->
	<ul>
	  <% @events.each do |event| -%>
		<li>
			<%= link_to '#', :class => 'afisha-item-header', 'data-hash' => "##{Russian.strftime(event.date, '%d.%m.%Y')}" do %>
        <%=raw Russian.strftime(event.date, '%a').mb_chars.upcase %>
			  <%=raw Russian.strftime(event.date, '| <strong>%d %B</strong> | %H:%M').mb_chars.downcase %> -
			  <%= event.name %> | <%= event.price %>
			<% end %>
			
			<div class="event closed<%= ' today' if event.date.today? %>">
        <% if event.attachments.count > 0 -%>
          <%= image_tag event.attachments.first.image.url(:event), :class => 'main', :style => 'top: -42px;' %>
        <% end -%>
        <div class="event_content">
          <div class="short_content">
            <%=raw event.short_description %>
          </div>

          <div class="full_content">
            <%=raw event.description %>
            
            <% like_url =  url_for :host =>'http://www.facebook.com/sharer.php',
                        :s => 100,
                        :p => {
                          :title => event.name,
                          :summary => strip_tags(event.short_description),
                          :url => events_bydate_url(:date => Russian.strftime(event.date, '%d.%m.%Y')),
                          :images => [event.attachments.first.image.url(:event)]
                        } %>
          
            <a onClick="window.open('<%= like_url %>','sharer','toolbar=0,status=0,width=548,height=325');" href="javascript: void(0)">like</a>
          </div>
        </div>

        <div class="read_more">
          <a href="#" class="read_more_link">Далее</a>
        </div>

        <div class="clearfix"></div>
      </div>
			
		</li>
		<% end -%>
	</ul>
<!--	<a class="afisha-pager" href="#"><div class="arrow-down"></div></a>-->
</div>


<% content_for :page_javascript do %>
  $(function() {
    $('.read_more_link').click(function() {
      $(this).closest('.event').squatEvent('open');
      return false; 
    });
    
    $('.afisha-item-header').click(function() {
      var $event= $(this).parent().children('.event');
      var $li = $(this).closest('li');
      
      if($event.hasClass('animated')) {
        return false;
      }
      
      if($event.hasClass('closed')) {
        $event.squatEvent('open');
        $('.event.opened').squatEvent('close', function() {  
          $.scrollTo($li, 500, {offset: -50});
        });
      } else if($event.hasClass('opened'))  {
        $event.squatEvent('close');
      }
      return false; 
    });
    
    window.setTimeout(function() {
      var $event = $('.today:first');
      if(location.hash != "") {
        $event = $('a.afisha-item-header[data-hash="'+location.hash+'"]').parent().children('.event');
      }
      var $li = $event.closest('li');

      $event.squatEvent('open', function() {
        return;
      }, 0);
      $.scrollTo($li, 0, {offset: -50});
    }, 500);

  });
<% end %>

